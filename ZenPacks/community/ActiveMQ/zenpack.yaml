name: ZenPacks.community.ActiveMQ

zProperties:
  zJolokiaPort:
    category: Jolokia
    type: int
    default: 8161
  zJolokiaUsername:
    category: Jolokia
    type: string
    default: admin
  zJolokiaPassword:
    category: Jolokia
    type: password
    default: admin

class_relationships:
  - ActiveMQDevice 1:MC ActiveMQBroker
  - ActiveMQBroker 1:MC ActiveMQQueue
  - ActiveMQBroker 1:MC ActiveMQQueueDLQ

classes:
  ActiveMQDevice:
    base: [zenpacklib.Device]
    label: AMQ Device

  ActiveMQBroker:
    base: [zenpacklib.Component]
    label: ActiveMQ Broker
    properties:
      DEFAULTS:
        grid_display: false
      brokerId:
        label: Broker ID
        grid_display: true
        label_width: 300
      version:
        label: Version
        grid_display: true
      status:
        label: Status
        type: string
        datapoint: broker_health
        renderer: Zenoss.render.severity
        grid_display: true
        label_width: 40
      objectName:
        label: ObjectName

  ActiveMQQueue:
    base: [zenpacklib.Component]
    label: ActiveMQ Queue
    properties:
      objectName:
        label: ObjectName
        grid_display: false
    monitoring_templates: [ActiveMQQueue]

  ActiveMQQueueDLQ:
    base: [zenpacklib.Component]
    label: ActiveMQ Dead Letter Queue
    properties:
      objectName:
        label: ObjectName
        grid_display: false
      queueSize:
        datapoint: queue_queueSize
        grid_display: true
    monitoring_templates: [ActiveMQQueueDLQ]

device_classes:
  /Server/Linux/ActiveMQ:
    zProperties:
      zPythonClass: ZenPacks.community.ActiveMQ.ActiveMQDevice
      zCollectorPlugins:
        - zenoss.snmp.NewDeviceMap
        - zenoss.snmp.DeviceMap
        - zenoss.snmp.InterfaceMap
        - zenoss.snmp.RouteMap
        - zenoss.snmp.IpServiceMap
        - zenoss.snmp.HRFileSystemMap
        - zenoss.snmp.HRSWRunMap
        - zenoss.snmp.CpuMap
        - zenoss.snmp.SnmpV3EngineIdMap
        - community.json.ActiveMQ
      zDeviceTemplates:
        - Device

    templates:
      ActiveMQBroker:
        targetPythonClass: ZenPacks.community.ActiveMQ.ActiveMQBroker
        datasources:
          brokerhealth:
            type: Python
            plugin_classname: ZenPacks.community.ActiveMQ.dsplugins.ActiveMQBroker.ActiveMQBroker
            datapoints:
              health: GAUGE
          broker:
            type: Python
            plugin_classname: ZenPacks.community.ActiveMQ.dsplugins.ActiveMQBroker.ActiveMQBroker
            datapoints:
              uptime: GAUGE
        graphs:
          Uptime:
            units: minutes
            width: 1000
            miny: 0
            graphpoints:
              Uptime:
                dpName: broker_uptime

      ActiveMQQueue:
        targetPythonClass: ZenPacks.community.ActiveMQ.ActiveMQQueue
        datasources:
          queue:
            type: Python
            plugin_classname: ZenPacks.community.ActiveMQ.dsplugins.ActiveMQQueue.ActiveMQQueue
            datapoints:
              consumerCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              enqueueCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              dequeueCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              expiredCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              queueSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              averageMessageSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              maxMessageSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
        graphs:
          Messages:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Consumer Count:
                dpName: queue_consumerCount
              Expired Count:
                dpName: queue_expiredCount
          Queue:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Queue Size:
                dpName: queue_queueSize
          Flow:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Enqueue Count:
                dpName: queue_enqueueCount
              Dequeue Count:
                dpName: queue_dequeueCount
          Message size:
            units: bytes
            width: 1000
            miny: 0
            graphpoints:
              Average Message Size:
                dpName: queue_averageMessageSize
              Max Message Size:
                dpName: queue_maxMessageSize

      ActiveMQQueueDLQ:
        targetPythonClass: ZenPacks.community.ActiveMQ.ActiveMQQueueDLQ
        datasources:
          queue:
            type: Python
            plugin_classname: ZenPacks.community.ActiveMQ.dsplugins.ActiveMQQueue.ActiveMQQueue
            datapoints:
              consumerCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              enqueueCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              dequeueCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              expiredCount:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              queueSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              queueSizeDelta:
                rrdtype: GAUGE
                rrdmin: 0
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              averageMessageSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
              maxMessageSize:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'
        thresholds:
          DLQMessages:
            dsnames: [queue_queueSizeDelta]
            eventClass: /Status/ActiveMQ/DLQ
            severity: 4
            maxval: 0
        graphs:
          Messages:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Consumer Count:
                dpName: queue_consumerCount
                cFunc: LAST
              Expired Count:
                dpName: queue_expiredCount
                cFunc: LAST
          Queue:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Queue Size:
                dpName: queue_queueSize
                sequence: 1
                cFunc: LAST
              Queue Size Delta:
                dpName: queue_queueSizeDelta
                lineType: AREA
                sequence: 2
                cFunc: LAST
          Flow:
            units: messages
            width: 1000
            miny: 0
            graphpoints:
              Enqueue Count:
                dpName: queue_enqueueCount
                cFunc: LAST
              Dequeue Count:
                dpName: queue_dequeueCount
                cFunc: LAST
          Message size:
            units: bytes
            width: 1000
            miny: 0
            graphpoints:
              Average Message Size:
                dpName: queue_averageMessageSize
                cFunc: LAST
              Max Message Size:
                dpName: queue_maxMessageSize
                cFunc: LAST

event_classes:
  /Status/Jolokia:
    remove: false
    description: Jolokia event class
  /Status/ActiveMQ:
    remove: false
    description: ActiveMQ event class
  /Status/ActiveMQ/DLQ:
    remove: false
    description: ActiveMQ event class
  /Status/ActiveMQ/Broker:
    remove: false
    description: ActiveMQ event class

